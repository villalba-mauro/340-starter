<%# Vehicle Detail Page - P√°gina de detalle del veh√≠culo %>

<%# Vehicle Detail Display - Shows the detailed vehicle information %>
<div class="detail-container">
  <%- detailHtml %>
  
<!-- ‚úÖ FAVORITES: Botones AJAX para usuarios logueados -->
<% if (locals.loggedin) { %>
  <div class="favorite-section">
    <button id="favoriteBtn" 
            class="btn-favorite <%= locals.isFavorite ? 'favorited' : '' %>"
            data-inv-id="<%= locals.vehicle.inv_id %>"
            data-is-favorite="<%= locals.isFavorite ? 'true' : 'false' %>">
      <span class="btn-icon"><%= locals.isFavorite ? '‚ù§Ô∏è' : 'ü§ç' %></span>
      <span class="btn-text"><%= locals.isFavorite ? 'Remove from Favorites' : 'Add to Favorites' %></span>
    </button>
  </div>

<% } %>

<style>
.favorite-section {
  margin-top: 20px;
  text-align: center;
  padding: 15px;
  border-top: 1px solid #eee;
}

.btn-favorite {
  display: inline-block;
  padding: 12px 24px;
  margin: 10px;
  text-decoration: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: bold;
  transition: all 0.3s ease;
  border: 2px solid;
}

.btn-favorite:not(.favorited) {
  background-color: #007bff;
  color: white;
  border-color: #007bff;
}

.btn-favorite:not(.favorited):hover {
  background-color: #0056b3;
  border-color: #0056b3;
  color: white;
  text-decoration: none;
  transform: translateY(-2px);
}

.btn-favorite.favorited {
  background-color: #dc3545;
  color: white;
  border-color: #dc3545;
}

.btn-favorite.favorited:hover {
  background-color: #c82333;
  border-color: #c82333;
  color: white;
  text-decoration: none;
  transform: translateY(-2px);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const favoriteBtn = document.getElementById('favoriteBtn');
  
  if (favoriteBtn) {
    favoriteBtn.addEventListener('click', function() {
      const invId = this.dataset.invId;
      const isFavorite = this.dataset.isFavorite === 'true';
      const action = isFavorite ? 'remove' : 'add';
      const url = `/account/favorites/${action}/${invId}`;
      
      // Deshabilitar bot√≥n durante petici√≥n
      this.disabled = true;
      this.style.opacity = '0.6';
      
      // Petici√≥n AJAX
      fetch(url, {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        // Mostrar toast inmediatamente
        const toastType = data.success ? 'success' : 'error';
        showToast(data.message, toastType);
        
        if (data.success) {
          // Actualizar bot√≥n sin recargar p√°gina
          const newIsFavorite = data.action === 'added';
          this.dataset.isFavorite = newIsFavorite.toString();
          this.className = newIsFavorite ? 'btn-favorite favorited' : 'btn-favorite';
          
          const icon = this.querySelector('.btn-icon');
          const text = this.querySelector('.btn-text');
          
          if (newIsFavorite) {
            icon.textContent = '‚ù§Ô∏è';
            text.textContent = 'Remove from Favorites';
          } else {
            icon.textContent = 'ü§ç';
            text.textContent = 'Add to Favorites';
          }
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('Connection error. Please try again.', 'error');
      })
      .finally(() => {
        // Re-habilitar bot√≥n
        this.disabled = false;
        this.style.opacity = '1';
      });
    });
  }
});
</script>
